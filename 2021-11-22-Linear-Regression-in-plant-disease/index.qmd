---
title: "Linear Regression in plant disease"
author: "Sith Jaisong"
date: '2021-11-22'
categories:
- R
- PDE
tags:
- Plant Disease
- ggplot
- PDE
---

# เกริ่น

AUDPC ไม่ใช่วิธีการเดียวในการสรุปการพัฒนาของโรค อีกวิธีการหนึ่งที่มักใช้คือการวิเคราะห์การถดถอย
การวิเคราะห์การถดถอยเป็นเครื่องมือทางสถิติสำหรับอธิบายความสัมพันธ์ระหว่างตัวแปรเชิงปริมาณตั้งแต่สองตัวขึ้นไป
โดยที่ตัวแปรหนึ่งตัว (ตัวแปรตามหรือตัวแปรตอบสนอง) อาจถูกทำนายจากตัวแปรอื่น (ตัวแปรอิสระหรือตัวแปรทำนาย) ตัวอย่างเช่น หากทราบความสัมพันธ์ระหว่างความรุนแรงของโรคกับเวลา ความรุนแรงของโรคสามารถคาดการณ์ได้ในเวลาที่กำหนด

ถ้าเรามีตัวแปรทำนายเพียงตัวเดียวและการตอบสนองและตัวแปรตามมีความสัมพันธ์เชิงเส้น ข้อมูลก็สามารถวิเคราะห์ได้ด้วยแบบจำลองหรือสมการเชิงเส้นได้ หรือถ้าเมื่อมีตัวแปรทำนายมากกว่าหนึ่งตัว อาจใช้การถดถอยพหุคูณ ในส่วนนี้จะเสนอตัวอย่างของการวิเคราะห์ถดถอยเชิงเส้นโดย R

```{r}
library(tidyverse)
library(knitr)
library(patchwork)
library(ggthemes)
library(rmarkdown)
theme_set(theme_few())
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
options(digits = 3)
```
# ตัวอย่างข้อมูลความรุนแรงของโรคและอุณหภูมิ

```{r }
disease <- tribble(
  ~diseasev, ~temperature,
  1.9, 2,
  3.1, 1,
  3.3, 5,
  4.8, 5,
  5.3, 20,
  6.1, 20,
  6.4, 23,
  7.6, 10,
  9.8, 30,
  12.4, 25
  )
disease
```

## linear graph
เพื่อศึกษาหาความสัมพันธ์ระหว่างอุณหภูมิกับความรุนแรงของโรคว่ามีความสัมพันธ์แบบเชิงเส้นหรือไม่
ก่อนอื่นเราต้องกำหนด สมมุติฐานเพื่อพิสูจน์ว่า ตัวแปรสองตัวนี้มีความสัมพันธ์เชิงเส้นหรือไม่โดยกำหนด
์Null hypothesis ว่า ไม่มีความสัมพันธ์ระหว่าง ตัวแปรต้น (predictors) และตัวแปรตาม (response) ทดสอบด้วยการคำนวน F statistic ค่า *p* -value ของ F statistic ใช้เพื่อปฎิเสธ NULL hypothesis

```{r}
disease %>% ggplot(aes(x = temperature, y = diseasev)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE)
```

เส้นที่แสดง ด้วย function `geom_smooth(method = lm)` จะแสดง best fitted line อย่างไรก็ตาม จุดอยู่ไกลจากเส้นตรง บ่งชี้ถึงความสัมพันธ์ระหว่างตัวแปรทั้งสอง จะมากน้อยขึ้นกับระยะห่างของเส้นตรงนี้ ยิ่งจุดใกล้เส้นมากเท่าไหร่ ตัวแปรทั้งสองก็ยิ่งสัมพันธ์เชิงเส้นกันมากขึ้นเท่านั้น

กราฟที่แสดงข้างล่างเป็นกราฟที่ ที่แสดงค่า R และค่า *p* value ใช้ script ข้างล่างนี้
```{r}
library(ggpubr) # เพื่อใช้ ggscatter function

ggscatter(
  disease,
  x = "temperature",
  y = "diseasev",
  add = "reg.line",
#  conf.int = TRUE,
  cor.coef = TRUE,
  cor.method = "pearson"
  )
```

ต่อมาวิเคราะห์ linear regression กัน

```{r}
lm_mod <- lm(diseasev ~ temperature, data = disease)
summary(lm_mod)
```

มาดูความหมายของแต่ละตัวเลข ที่สำคัญจากผลการวิเคราะห์
ค่า temperature 0.2417 คือค่า beta estimate ตาม สูตร ![](https://i.stack.imgur.com/uC5Jnm.png) หรือ ที่รู้จักกันค่า slope นั้นเอง ซึ่ง คือ ปริมาณของตัวแปรตามจะเปลี่ปริมาณของตัวแปรตามจะเปลี่ยนแปลง เมื่อตัวแปรต้นเปลี่ยนไป 1 หน่วยในกรณีนี้ คือ เมื่อ temperture เพิ่มขึ้น 1 หน่วย ค่า diseasev จะเพิ่มขึ้น 0.02417 เปอร์เซ็นต์ และ ค่า intercept นั้น คือ ค่าตัดแกน y

อีกค่าที่ ควรดู คือ adjust r square มี ค่า 0.6 ซึ่ง ชี้ให้เห็นว่า สมาการเส้นตรง สามารถอถิบายได้ 60% ของ ความแปรปรวน (variance) ในข้อมูล

ส่วน `Pr(>|t|)` ชี้ให้เห็นว่า ค่ายิ่งน้อย ความสัมพันธ์ระหว่าง temperature และ diseasev นั้น ไม่ได้เกิดขึ้นโดยบังเอิญ (random chance) หรือ ปฎิเสธ Null hypothesis ที่ว่า ตัวแปรต้นกับตัวแปรตามไม่มีความสัมพันธ์ระหว่างสองตัวแปรต้นและตาม (there is no linear correlation between two variables)

## มีอะไรที่ต้องดูมากกว่าแค่เส้นตรง
ก่อนหรือหลังวิเคราะห์หาความสัมพันธ์หรือทดสอบความสัมพันธ์ว่าเป็นแบบเชิงเส้นนั้น เพื่อให้เกิดความน่าเชื่อมั่นว่า สามารถใช้การวิเคราะห์ความสัมพันธ์เชิงเส้นได้นั้น ควรทำการพิสูจ์สมมุติฐาน 4 ข้อ โดยจะนำเสนอการตรวจโดยใช้ function `check_model()` จาก package ชื่อว่า `performance`

```{r}
library(performance)
check_model(lm_mod)
```
1. **Linearity**


ดูจากกราฟ Residuals vs Fitted plot ตรวจความสัมพันธ์เชิงเส้น โดยสังเกตจาก เส้นแนวนอนระนาบ (เส้นประ) ถ้าเบี่ยงเบนจากเส้นประนี้มาก ๆ บ่งชี้ได้ว่า ความสัมพันธ์อาจจะไม่เป็นเส้นตรง อาจจะต้องหาความสัมพันธ์ด้วยวิธีอื่น

2. **Heteroscedasticity** หรือ **Homogeneity of Variance**


สังเกตเส้นแนวนอนระนาบ (เส้นประ) horizontal red line with points equally spread out indicates a well-fit model. A non-horizontal line or points that cluster together suggests that your data are not homoscedastic.

3. **Outlier values**


ดูกราฟ Residuals vs Leverage ช่วยให้เห็น outlier ซึ่งส่งผลต่อผลการวิเคราะห์ได้ ซึ่งจากกราฟ ก็จะสังเกตเห็นว่า มีอยู่ 1 ค่าที่ เป็น outlier


4. **Normality of residuals**


ประเมิน ด้วย QQplot หรือ Residuals vs Density กราฟ QQplot แสดงค่า residuals (ความแตกต่างระหว่างค่าที่วัดได้ observed value กับค่าที่ได้จากการพยากรณ์ predicted value) จากโมเดล หรือ สมการ ว่า มีการแจกแจงแบบปกติ หรือไม่ ถ้า residuals (จุด) อยู่บนระนาบเส้น แสดงว่ามีการกระจายแบบปกติ แต่ถ้ามีการกระจายตัวออกห่างเส้นมากเท่าไหร่ ก็ แสดงว่า มีการแจงแจงไม่ปกติ หรือจะดู Residuals vs Density ว่าไม่การกระจายซ้อนทับกับเส้นการกระจายปกติ (เส้นสีเขียว) ถ้าไม่ ก็ควรจะใช้วิธีอื่นในการวิเคราะห์

สุดท้ายอยากให้ลองนำไปทดลองใช้กับข้อมูลของตัวเองดูนะครับ
